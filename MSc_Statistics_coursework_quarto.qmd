---
title: "Assignment 1"
subtitle: 'MSc in Statistics 2025/26, Imperial College London'
author: "Jesus Antonio Pinera Esquivel, 06053484"
format:
  html:
    toc: true
    highlight: tango
    self-contained: true
    df-print: paged
  pdf: default
format-links: false
bibliography: "MSc_Statistics_coursework_template_quarto.bib" 
---

<style type="text/css">
h1{
  font-size: 24pt
}
h2{
  font-size: 18pt;
}
body{
  font-size: 12pt;
}
</style>

```{r setup, include = FALSE, tidy=TRUE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
include_solutions = TRUE
```

```{r setup2, include=FALSE, tidy=TRUE}
require(rmarkdown)
require(knitr)
require(kableExtra)
library(ggplot2)
library(purrr)
library(patchwork)
library(GGally)
library(dplyr)
# Put any library imports and other preamble here.
```

This document is part of the assignments for the Data Science Course at Imperial College London for the MSc in Statistics.

# Analysis of `palmenr::penguins` dataset

The first part consist of reproducing the analysis presented in `refining-your workflows.qmd` based on the dataset `penguins`, first published by @kristen2014ecological. Below is an example of the top rows of the Palmer penguin dataset.

```{r}
#| label: tbl-palmer
#| tbl-cap: "Example rows of the Palmer penguin dataset."


df = palmerpenguins::penguins
kable(head(df))
```

## Exploratory data analysis

Let us first start with some EDA. First, let us analyze how the numeric variables behave relative to the species. This is, if there are significant differences observed in bill and flipper characteristics for different species. As we observe in @fig-1, there are significant differences between species. For instance, Adelies have consistently shorter bills than Chinstraps and Gentoos. On the other hand, Gentoos differentiate from the other two species in the remaining characteristics: they have smaller bill depth, longer flippers, and more mass.

```{r}
#| label: fig-1
#| fig-cap: "Bill, flipper and mass characteristics by species"

# Figure 1 plotting

vars = c("bill_length_mm", 
          "bill_depth_mm",
          "flipper_length_mm",
          "body_mass_g")

plot_var = function(v){
  ggplot(df,
         aes(x = .data[[v]], 
             fill = species, 
             color = species)) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 2, guides = "collect") & theme(legend.position = "top")
  
```

Now, let us analyze differences by sex. @fig-2 shows the same plot as before. First, note that, unlike the species, the sex was not recorder for many penguins. For the observations we do have, we can observe that bill lenth and depth, and body mass, are larger for male penguins. There is, however, an apparent bimodal distribution by sex. These, combined with the missing values, might be due to differences in species rather than sex.

```{r}
#| label: fig-2
#| fig-cap: "Bill, flipper and mass characteristics by sex"

# Figure 2 plotting

plot_var = function(v){
  ggplot(df,
         aes(x = .data[[v]], 
             fill = sex, 
             color = sex)) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 2, guides = "collect") & theme(legend.position = "top")

```

Next, let us analyze the characteristics by the island. Again, we see significant differences. However, this might be due to the fact that species inhabit certain islands in particular. This would be expected, as penguins adapt to their habitat and thus generate different species characteristics.

```{r}
#| label: fig-3
#| fig-cap: "Bill, flipper, and mass characteristics by island"

# Figure 3 plotting

plot_var = function(v){
  ggplot(df,
         aes(x = .data[[v]], 
             fill = island, 
             color = island)) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 2, guides = "collect") & theme(legend.position = "top")
```

Finally, let us see if there are changes of the variables through time grouping with the years. In @fig-4 we can observe the distributions from 2007 to 2009. Unlike previous plots, we don't see dramatic differences in the distributions by year.

```{r}
#| label: fig-4
#| fig-cap: "Bill, flipper, and mass characteristics by year"

# FIgure 4 plotting

plot_var = function(v){
  ggplot(df,
         aes(x = .data[[v]], 
             fill = factor(year), 
             color = factor(year))) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 2, guides = "collect") & theme(legend.position = "top")
```

## Relationships

We will now check if there are interesting relationships between the variables, along groupings. @fig-5 shows scatterplots for the different variables, along calculated (Pearson) correlations, coloring by species. We can see clear positive relationships between the different variables, particularly between flipper length and body mass. Note, however, that the relationship without the grouping is negative for some pairs, whereas when grouping it turns positive. Thus, we have a great example of Simpson's paradox. It is also noteworthy to observe that some scatters are clearly distinguishable from the others, like Gentoo's bill depth and flipper length.

```{r, fig.height=5}
#| label: fig-5
#| fig-cap: "Scatterplots for the numeric variables of the penguins dataset, coloring by species"

# Figure 5 plotting

ggpairs(df |> 
select(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g),
aes(color = species, alpha = 0.5),
columns = 2:5) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
```

Turning to sex, in @fig-6 we can now actually see the whole story of the multimodal distributions we saw earlier. There are clear clusters on the different characteristics, given by the species. For each cluster, we can see a clear differentiation between male and female characteristics. Thus, males and females are very distinguishable, but the species mask this fact. It is worth nothing that, even though correlations are negative by sex for some variables, the actual relationships are clearly positive. The negative correlations are drawn more by the cumulus observed in the species groupings, generating apparent "negatively sloped" relations. See, for instance, bill depth versus flipper length.

```{r, fig.height=5}
#| label: fig-6
#| fig-cap: "Scatterplots for the numeric variables of the penguins dataset, coloring by sex"

# Figure 6 plotting

ggpairs(df |> 
select(sex, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g),
aes(color = sex, alpha = 0.5),
columns = 2:5) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
```

# Analysis of `datasets::ChickWeight` dataset

The second part consist of making an analysis similar to the previous one but for the `ChickWeight` dataset, analized in @crowder1990analysis. Below is an example of the top rows of the Chicks dataset. We have a chick indicator, time (living days of the chick), and type of diet.

```{r}
#| label: tbl-chicks
#| tbl-cap: "Example rows of the Chicks dataset."

# Table 2 = 

df = datasets::ChickWeight
kable(head(df))
```

## Exploratory data analysis

As before, let us analyze how the numeric weight behaves relative to the diet, which is the main variable. This is, if there are significant differences observed in which weight relative to diet. Ww focus only on chicks with more than 10 days of life. There does not seem to be significant differences observed by diet, albeit the Diet 3 has the heaviest right tail, whereas Diet 1 seems to be generating the lightest chicks.

```{r}
#| label: fig-7
#| fig-cap: "Weight of chicks by diet"

# Figure 7 plotting

vars = c("weight")

plot_var = function(v){
  ggplot(df |> 
  filter(Time>10),
         aes(x = .data[[v]], 
             fill = Diet, 
             color = Diet)) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 1, guides = "collect") & theme(legend.position = "top")
  
```

Now, let us analyze differences by time. @fig-2 shows the same plot as before by days of living for chicks with more than 6 days. We can observe two things: greater weight, and greater variability through time, indicative of heteroscedasticity on weight behaviour.

```{r}
#| label: fig-8
#| fig-cap: "Weight by time"

# Figure 2 plotting

plot_var = function(v){
  ggplot(df |> 
  filter(Time>6),
         aes(x = .data[[v]], 
             fill = factor(Time), 
             color = factor(Time))) +
    geom_histogram(aes(y = after_stat(density)), 
                   bins = 30, 
                   alpha = 0.25, 
                   position = "identity") +
    geom_density(linewidth = 0.8, 
                 fill = NA) +
    labs(title = gsub("_", " ", v), 
         x = NULL, 
         y = NULL) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
}

plots = map(vars, plot_var)
wrap_plots(plots, ncol = 1, guides = "collect") & theme(legend.position = "top")


```

## Relationships

Let us know analyze potential relationships between the variables. Given the previous analysis, it might be worthwile analyzing how diets evolve through time. @fig-9 shows the evolution of weight through time by diet, with a LOESS regression and 95% confidence intervals. Unlike previous plots, we can now observe a "clear winner": Diet 3. Even though Diet 3 starts slow, producing chicks similar in weight to Diets 2 and 4, by day 22 it produces the heaviest chicks consistently, with the CIs between Diets 3 and 4 barely touching. On the other hand, Diet 1 produces the lightest chicks, as hinted in the histogram plots.

```{r, fig.height=5}
#| label: fig-9
#| fig-cap: ""

df |> 
  ggplot(aes(x = Time,
             y = weight,
             color = Diet)
         ) +
  geom_point(alpha = 0.2) +
  geom_smooth() +
  theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold", hjust = 0),
          panel.grid.minor = element_blank())
```

# References




